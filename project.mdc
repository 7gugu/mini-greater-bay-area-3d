# Role
你是一位精通 WebGL、Three.js 和高德地图 (AMap JS API v2.0) 开发的资深前端工程师。

# Project Context
我们要实现一个基于 **大湾区 (Greater Bay Area)** 的高铁运行可视化项目，灵感来源于 **Mini Tokyo 3D**。
目前我们已经完成了核心功能开发，实现了基于真实时刻表和地理路径的列车运行模拟，并内置了一个强大的在线编辑器。

# Current Tech Stack & Decisions
1.  **Language**: TypeScript (All source code migrated to TS).
2.  **Build System**: Webpack + Jest (Unit Testing).
3.  **Map Provider**: 高德地图 (AMap) JS API v2.0。
4.  **Rendering**: 
    - 使用 `AMap.GLCustomLayer` 结合 **Three.js** (v0.160.0)。
    - 使用 **three.meshline** 绘制有宽度、有颜色的轨道线。
5.  **Data Structure**:
    - `RailSystemData`: 包含 `tracks` (物理路径) 和 `trips` (时刻表)。
    - `TrackGeometry`: 支持 Catmull-Rom 曲线平滑处理。
6.  **UI Framework**: 原生 DOM + CSS (Glassmorphism 风格)。

# Current Working Code (Stable)
项目结构已经模块化：
- `src/main.ts`: 入口文件，初始化地图、Three.js 场景、编辑器和播放控制器。
- `src/Train.ts`: `Train` 类，封装了 Mesh 创建、位置插值更新逻辑。
- `src/Editor.ts`: 在线编辑器，支持轨道拖拽修改、时刻表增删改、Local Storage 持久化。
- `src/PlaybackController.ts`: 时间控制器，支持暂停/重播、时间倍速（UI待实现）、真实日期显示。
- `src/utils.ts`: 几何计算（路径长度、Catmull-Rom 平滑插值）。
- `src/data.ts`: 模拟数据生成与加载。

# Completed Features
1.  **真实数据驱动**:
    -   支持多段行程 (`TripLeg`)。
    -   列车位置严格基于时间戳计算。
2.  **在线编辑器 (Online Editor)**:
    -   **Tracks Tab**: 可视化编辑轨道路径点，支持添加/删除/重命名节点。
    -   **Schedule Tab**: 管理列车班次和发车时间。
    -   **Persistence**: 数据自动保存到 Local Storage。
3.  **视觉升级**:
    -   **轨道**: 使用 `MeshLine` 渲染发光的粗线条，支持自定义颜色。
    -   **站点**: 自动识别并渲染为黑边白底的圆形站点。
    -   **UI**: 现代化的深色毛玻璃风格 (Glassmorphism)。
4.  **播放控制**:
    -   支持暂停、重播。
    -   显示真实的模拟时间（日期+毫秒级时间）。
5.  **路径平滑**:
    -   自动对折线路径应用 Catmull-Rom 插值，使列车转弯更加流畅。

# Next Steps
接下来的开发重点（按优先级）：

1.  **性能优化 (Performance)**:
    -   **视锥体剔除 (Frustum Culling)**: 增加不可视区域不渲染逻辑，优化大规模场景下的性能。
    -   **InstancedMesh**: 当列车数量超过 100+ 时，迁移到 `InstancedMesh` 渲染列车。

2.  **数据集成 (Data Integration)**:
    -   编写转换器，将真实的 GTFS 或 GeoJSON 数据转换为 `RailSystemData` 格式。

3.  **视觉效果 (Visuals)**:
    -   **发光效果 (Bloom)**: 使用 Three.js Post-processing 增加霓虹灯质感。
    -   **拖尾效果 (Trails)**: 为高速行驶的列车增加动态拖尾。

4.  **交互功能 (Interaction)**:
    -   点击列车显示详细信息（车次、始发终到、当前速度）。
    -   相机跟随模式（点击列车后视角锁定）。
